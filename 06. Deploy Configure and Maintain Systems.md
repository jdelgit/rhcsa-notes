## Schedule tasks using at and cron

###  *at*
Usually used for one time scheduled task
`sudo yum install at`

##### Create Job with at
`#  at <runtime>` 
`at> <command-to-run>`
`at> <EOT>`


`#  at <time> -f <script-filename>`
##### List queued jobs
`atq`

##### Remove job from queue
`atrm <#job>`

###  *Cron*

Datetime-syntax:  minute hour day(month) month day(week)
Crontab time check: https://crontab.guru/

##### Edit global cron
`#  crontab -e`

`<time> <script-path>`

##### Edit user-specific cron
`#  crontab -u <user> -e`

##### List scheduled tasks
`#  crontab -l`

##### Leverage Cron folders for automation
Cron related folders can be used to place executables to run depeninding on the time intereval noted. The scheduling of the running of the scripts is (should be) defined int `/etc/crontab`

```
/etc/
 ├── cron.d  
 ├── cron.daily  
 ├── cron.deny  
 ├── cron.hourly   
 ├── cron.monthly  
 ├── crontab 
 └── cron.weekly
```

Example of `/etc/crontab` contents for the scheduling of the cron folders

```
# /etc/crontab: system-wide crontab
# Unlike any other crontab you don't have to run the `crontab'
# command to install the new version when you edit this file
# and files in /etc/cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL=/bin/sh
# You can also override PATH, by default, newer versions inherit it from the environment
#PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed

7 * * * *  root cd / && run-parts — report /etc/cron.hourly
5 23 * * * root cd / && run-parts — report /etc/cron.daily
5 23 * * 7 root cd / && run-parts — report /etc/cron.weekly
5 23 1 * * root cd / && run-parts — report /etc/cron.monthly
```


## Start and stop services and configure services to start automatically at boot

##### Start specific service
`#  systemctl start <service>`

##### Stop specific service
`#  systemctl stop <service>`

##### Reload specific service (after configuration change)
`#  systemctl reload <service>`

##### Restart specific service
`#  systemctl restart <service>`

##### Enable specific service to start at boot
`#  systemctl enable <service>`

##### Disable specific service from starting at boot
`#  systemctl disable <service>`

##### Check status of specific service
`#  systemctl status <service>`

**Status ouput**
```
● ssh.service - OpenBSD Secure Shell server  
    Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)  
    Active: active (running) since Thu 2022-06-30 08:25:14 CEST; 2h 35min ago  
      Docs: man:sshd(8)  
            man:sshd_config(5)  
   Process: 989 ExecStartPre=/usr/sbin/sshd -t (code=exited, status=0/SUCCESS)  
  Main PID: 1014 (sshd)  
     Tasks: 1 (limit: 35882)  
    Memory: 5.5M  
    CGroup: /system.slice/ssh.service  
            └─1014 sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups
```

`Loaded: <loaded-state> <unit-file>; <enabled/disabled> vendor preset: <enabled/disabled>`
Loaded : loaded in memory (loaded/error/bad-setting/masked)
enabled/disabled: Enabled will start at boot
vendor preset: Boot state set on installation


##### View configuration for service
`#  systemctl cat <service>`

##### Edit configuration for service
`#  systemctl edit <service>`

##### List  service dependencies
`#  systemctl list-dependencies <service>`

##### Prevent service from running
`#  systemctl mask <service>`

##### Remove mask from service
`#  systemctl unmask <service>`

## Configure systems to boot into a specific target automatically
##### View current default target
`#  systemctl get-default`

##### Change default target
`#  systemctl set-default <target>`


##### List loade units based on type

`#  systemctl list-units --type target`

## Configure time service clients
#### date command
*Formatting syntax*
	%D – Display date as mm/dd/yy
	%Y – Year (e.g., 2020)
	%m – Month (01-12)
	%B – Long month name (e.g., November)
	%b – Short month name (e.g., Nov)
	%d – Day of month (e.g., 01)
	%j – Day of year (001-366)
	%u – Day of week (1-7)
	%A – Full weekday name (e.g., Friday)
	%a – Short weekday name (e.g., Fri)
	%H – Hour (00-23)
	%I – Hour (01-12)
	%M – Minute (00-59)
	%S – Second (00-60)

##### Show date with formatting
`#  date +<Fromat>`

##### Set date
`#  date --set="YYYYmmdd HH:MM"`

#### date command
`#  hwclock`

##### Set system clock to same time as hwclock
`#  hwclock -s`

##### Set Hardware clock to systemclock time
`hwclock -w`


#### Timedatectl
##### timedatectl
```
#  timedatectl
    Local time: Thu 2022-06-30 05:50:07 EDT
    Universal time: Thu 2022-06-30 09:50:07 UTC
		RTC time: Thu 2022-06-30 09:50:07
		Time zone: America/New_York (EDT, -0400)
System clock synchronized: yes
              NTP service: active
	RTC in local TZ: no

```

NTP service: Get time info from the internet

##### Set time 
`#  timedatectl set-time 2022-06-30`
`#  timedatectl set-time 11:52:00`

##### List timezone 
`#  timedatectl list-timezones`

##### Set timezone 
`#  timedatectl set-timezone <timezone>`

##### Set ntp
`#  timedatectl set-ntp <yes/no>`

##### Install and configure ntp
`#  sudo yum install chrony`
`#  sudo systemctl --now start chrony`
`#  sudo vi /etc/chrony.conf`  -> ensure a (public)server is configured



## Install and update software packages from Red Hat Network, a remote repository, or from the local file system
#### Dnf

##### List packages matching pattern
`#  dnf list <pattern>`

##### List available repositories
`#  dnf repolist all`

##### Show info on used repositories
`#  dnf repoinfo`

##### Show info for specific package
`#  dnf info <package>`

##### Install specific package
`#  dnf install <package>`

##### Install package from rpm file
`#  dnf localinstall <path-to-package>`

##### Remove specific package
`#  dnf remove <package>`

##### Find out which package provides specific file
`dnf provides "*/bin/sh"`

##### List available package groups
`#  dnf groups list`

##### Install package group
`#  dnf group install "<group-name>"`

##### Remove package group
`#  dnf group remove "<group-name>"`

##### View dnf history
`#  dnf history list`

##### Undo action
`dnf history undo <id>`

##### Redo previous action
`dnf history redo <id>`

#### Manage repositories
##### Add repo to set
`#  yum-config-manager --add-repo <repo-url>`
or
`#  dnf config-manager --add-repo <repo-url>`

##### Enable repo in set
`#  yum-config-manager --enablerepo <reponame>`
or
`#  dnf config-manager --enablerepo <reponame>`

##### Disable repo in set
`#  yum-config-manager --disablerepo <reponame>`
or
`#  dnf config-manager --disablerepo <reponame>`

##### Create reposistory

You will need `dnf-utils` for additional `dnf` functionality
##### Install dnf-utils and createrepo
`#  sudo dnf install dnf-utils createrepo`

##### Create directory for repo and add packages to the directory
```
#  mkdir  <desire-repo-path>
#  cp <local-packages> <desire-repo-path>/
#  createrepo --database <desire-repo-path>
#  yum-config-manager --add-repo file:///<desire-repo-path>
```


## Work with package module streams
Modules separate multiple versions of a particular package

##### List modules
`#  dnf module list`

##### Get info on a particular module
`#  dnf module info --profile <module-name>`

##### Install module
`#  dnf module install <module-name>`

##### Install specific version of module
`#  dnf module install <module-name>:<stream>/<profile>`

##### Remove module
Uninstall then clear module from system with reset
`#  dnf module remove <module-name>`
`#  dnf module reset <module-name>`

## Modify the system bootloader
##### Set default boot choice
`#  grub2-set-default <option#>`

##### Edit grub2 config

**Edit parameter file**

```
#  vi /etc/default/grub
GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR="# (sed 's, release .*# ,,g' /etc/system-release)"
GRUB_DEFAULT=saved
GRUB_DISABLE_SUBMENU=true
GRUB_TERMINAL_OUTPUT="console"
GRUB_CMDLINE_LINUX="crashkernel=auto resume=/dev/mapper/rhel_rhelprep-swap rd.lvm.lv=rhel_rhelprep/root rd.lvm.lv=rhel_rhelprep/swap rhgb quiet"
GRUB_DISABLE_RECOVERY="true"
GRUB_ENABLE_BLSCFG=true

```

 **Verify and Set configuration**
`#  grub2-mkconfig -o /boot/grub2/grub.cfg`
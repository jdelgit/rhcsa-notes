## Configure firewall settings using firewall-cmd/firewalld
#### IP Forwarding
`# vi /etc/sysctl.conf`
set `net.ipv4.ip_forward` equal to `1` to enable
```
# sysctl settings are defined through files in  
# /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.  
#  
# Vendors settings live in /usr/lib/sysctl.d/.  
# To override a whole file, create a new file with the same in  
# /etc/sysctl.d/ and put new settings there. To override  
# only specific settings, add a file with a lexically later  
# name in /etc/sysctl.d/ and put new settings there.  
#  
# For more information, see sysctl.conf(5) and sysctl.d(5).

net.ipv4.ip_forward=1
```

###### Reload sysctl
`# sysctl -p`

### Firewall
 Please review [[07. Manage Basic Networking]] for a refresher

##### Add Portforward
`# firewall-cmd --add-forward-port=port=<port-(range)>:proto=<portocol>:toport=<port-(range)>:toaddr=<to-address> --permanent`
##### Remove Portforward
`# firewall-cmd --remove-forward-port=port=<port-(range)>:proto=<portocol>:toport=<port-(range)>:toaddr=<to-address> --permanent`


#### Add new service
 `# firewall-cmd  --add-service=<servicename> --permanent`

#### Remove service
 `# firewall-cmd  --remove-service=<servicename> --permanent`

## Manage default file permissions
 [Access Control Lists (acl)](https://www.redhat.com/sysadmin/linux-access-control-lists)
#### View acl for file/directory
`# getfacl <path>`

#### Set acl on file/directory for user

`# setfacl -m u:<username>:<permission> <path>` -> for user
`# setfacl -m g:<groupname>:<permission> <path>` -> for group

|Permissions|Access|
|-|-|
|-|No access|
|r--|read only|
|rw-|read write|
|r-x|read exectute, access to folders|
|rwx|Full access|

#### Remove acl from file/directory for user
`# setfacl -x u:<username>:<permission> <path>` -> for user
`# setfacl -x g:<groupname>:<permission> <path>` -> for group

If no permission is specified, all the acl settings on the file for that user will be removed.


ACL being active can be see with the `ls -la` command as a `+` right after the file permissions
Some filesystem do not support acl out of the box. For these they can be enabled in the `/etc/fstab` as an option for the respective drive.

## Configure key-based authentication for SSH
[How To Configure SSH Key-Based Authentication on a Linux Server](https://www.digitalocean.com/community/tutorials/how-to-configure-ssh-key-based-authentication-on-a-linux-server)

#### Generate key-pair
`$ ssh-keygen`

#### Copy generated key to desired server for logging in
`$ ssh-copy-id <serverIP>`

## Set enforcing and permissive modes for SELinux
[SELinux Project](https://selinuxproject.org/page/Main_Page)
[RedHat - What is SELinux](https://www.redhat.com/en/topics/linux/what-is-selinux)

#### View current enforcing state
`# getenforce`
or
`# sestatus`

#### Enable permissive mode
`# setenforce 0` -> Only last for session
 
 or
 
 Edit `/etc/selinux/config`  -> persists and is enabled after reboot
 `# vi /etc/selinux/config`
 Change `SELINUX=Enforcing` to `SELINUX=permissive`


## List and identify SELinux file and process context
[SELinux Security Context](https://selinuxproject.org/page/NB_SC)

#### List context on a path
```
$ ls -Z
unconfined_u:object_r:user_home_t:s0 test.txt
``` 
`<user>:<role>:type[:range]`

#### View users context
`$ id -Z`

#### View process context
`$ ps -Zaux`

#### View available contexts
`$ ls -la /etc/selinux/targeted/contexts/users/`
`$ cat /etc/selinux/targeted/contexts/users/<user-role>`

## Restore default file contexts
#### Change context
`# chcon <user>:<role>:type <path>`

#### Restore context
`# restorecon <path>`
`# restorecon -R <path>` -> recursive for entire directory


## Manage SELinux port labels
[Port labeling](https://www.thegeeksearch.com/how-to-manage-selinux-port-labeling/)

If `semanage` is not availble you will need to install `setroubleshoot-server`

`# dnf install setroubleshoot-server`

#### List port lables
`# semanage port -l`

#### Add port to existing port label
`# semanage port -a -t <port-label> -p tcp|udp <port#>`

#### Remove port to existing port label
`# semanage port -d -t <port-label> -p tcp|udp <port#>`

#### Modify port binding
`# semanage port -m -t <port-label> -p tcp|udp <port#> `

## Use boolean settings to modify system SELinux settings

### Get available booleans
`# getsebool -a | grep <desired-setting>`

or

`# semanage boolean -l | grep <desired-setting>` -> more details

### Set a  boolean
`# setsebool -P <bool> on|off` -> persistent
`# setsebool <bool> on|off`

## Diagnose and address routine SELinux policy violations
#### Consult audit logs
`# sealert -a /var/log/audit/audit.log`

`# ausearch -m AVC,USER_AVC,SELINUX_ERR`

`# audit2why -a`

`# audit2allow -aw`